<!-- src/app/home/home.component.html -->
<div class="home-container">

  <!-- Hero Section -->
  <section class="hero-section">
    <div class="hero-content">
      <h1>Find Your Next Favorite</h1>
      <p>Stream the best movies and shows across all your services.</p>
      <button class="hero-button" routerLink="/auth/register">Sign Up</button>
    </div>
  </section>

  <!-- Für eingeloggte Nutzer -->
  <ng-container *ngIf="isLoggedIn$ | async; else notLoggedIn">
    <section class="category-section" *ngFor="let category of categories">
      <h2>{{ category.title }}</h2>
      <div class="slider-container">
        <button class="slider-arrow left-arrow" (click)="scrollLeft(category.id)">◄</button>
        <div class="scroll-container" [id]="category.id">
          <div class="content-list">
            <div class="content-card" *ngFor="let item of category.items" (mouseleave)="stopRating()">

              <!-- Poster + Watchlist/Rating-Buttons -->
              <div
                class="card-image"
                [style.backgroundImage]="'url(' + (item.poster || 'https://placehold.co/200x300') + ')'"
              >
                <!-- Add to Watchlist Button -->
                <button
                  class="add-btn"
                  (click)="toggleWatchlist(item.tmdbId)"
                  [disabled]="isInWatchlist(item.tmdbId)"
                >
                  <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12 5v14M5 12h14"/>
                  </svg>
                </button>

                <!-- Start Rating Button -->
                <button class="rating-btn" (click)="startRating(item.tmdbId)">
                  <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                    <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                  </svg>
                </button>

                <!-- Eigene Bewertung -->
                <div class="own-rating-tag" *ngIf="getRating(item.tmdbId) !== null">
                  <span class="star-icon">★</span>
                  {{ getRating(item.tmdbId) }}
                </div>

                <!-- Rating Overlay + Input -->
                <div class="rating-overlay" *ngIf="selectedContentId === item.tmdbId && !isRatingSubmitted"></div>
                <div class="rating-input-container" *ngIf="selectedContentId === item.tmdbId && !isRatingSubmitted">
                  <div class="rating-input-wrapper">
                    <input
                      type="text"
                      [(ngModel)]="ratingScore"
                      placeholder="0.0 - 10.0"
                      class="rating-input"
                      (keydown.enter)="submitRating(item.tmdbId)"
                      #ratingInput
                    />
                    <button class="submit-rating-btn" (click)="submitRating(item.tmdbId)">Submit</button>
                  </div>
                </div>
              </div>

              <!-- Titel -->
              <p class="card-title">{{ item.title }} ({{ item.releaseYear }})</p>

              <!-- IMDb- & RT-Ratings -->
              <div class="ratings-container">
                <div class="imdb-rating">
                  <img src="/assets/images/imdb-logo.png" alt="IMDb" class="rating-icon imdb-rating-icon" />
                  {{ item.imdbRating != null
                     ? (item.imdbRating | number:'1.1-1')
                     : 'N/A' }}
                </div>
                <div class="rt-rating">
                  <img src="/assets/images/rt-logo-cf.png" alt="Rotten Tomatoes" class="rating-icon rt-rating-icon" />
                  {{ item.rtRating != null
                     ? (item.rtRating | number:'1.0-0') + '%'
                     : 'N/A' }}
                </div>
              </div>

            </div>
          </div>
        </div>
        <button class="slider-arrow right-arrow" (click)="scrollRight(category.id)">►</button>
      </div>
    </section>
  </ng-container>

  <!-- Für nicht eingeloggte Nutzer -->
  <ng-template #notLoggedIn>
    <section class="category-section" *ngFor="let category of categories | slice:0:3">
      <h2>{{ category.title }}</h2>
      <div class="slider-container">
        <button class="slider-arrow left-arrow" (click)="scrollLeft(category.id)">◄</button>
        <div class="scroll-container" [id]="category.id">
          <div class="content-list">
            <div class="content-card" *ngFor="let item of category.items">
              
              <div
                class="card-image"
                [style.backgroundImage]="'url(' + (item.poster || 'https://placehold.co/200x300') + ')'"
              >
                <button class="add-btn" (click)="router.navigate(['/auth/login'])">
                  <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12 5v14M5 12h14"/>
                  </svg>
                </button>
              </div>

              <p class="card-title">{{ item.title }} ({{ item.releaseYear }})</p>

              <div class="ratings-container">
                <div class="imdb-rating">
                  <img src="/assets/images/imdb-logo.png" alt="IMDb" class="rating-icon imdb-rating-icon" />
                  {{ item.imdbRating != null
                     ? (item.imdbRating | number:'1.1-1')
                     : 'N/A' }}
                </div>
                <div class="rt-rating">
                  <img src="/assets/images/rt-logo-cf.png" alt="Rotten Tomatoes" class="rating-icon rt-rating-icon" />
                  {{ item.rtRating != null
                     ? (item.rtRating | number:'1.0-0') + '%'
                     : 'N/A' }}
                </div>
              </div>

            </div>
          </div>
        </div>
        <button class="slider-arrow right-arrow" (click)="scrollRight(category.id)">►</button>
      </div>
    </section>
  </ng-template>

</div>
